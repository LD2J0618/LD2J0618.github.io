<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>如何在vps上部署Bark通知ssh连接及资源监控脚本</title>
      <link href="/essay/%E5%A6%82%E4%BD%95%E5%9C%A8vps%E4%B8%8A%E9%83%A8%E7%BD%B2Bark%E9%80%9A%E7%9F%A5ssh%E8%BF%9E%E6%8E%A5%E5%8F%8A%E8%B5%84%E6%BA%90%E7%9B%91%E6%8E%A7%E8%84%9A%E6%9C%AC/"/>
      <url>/essay/%E5%A6%82%E4%BD%95%E5%9C%A8vps%E4%B8%8A%E9%83%A8%E7%BD%B2Bark%E9%80%9A%E7%9F%A5ssh%E8%BF%9E%E6%8E%A5%E5%8F%8A%E8%B5%84%E6%BA%90%E7%9B%91%E6%8E%A7%E8%84%9A%E6%9C%AC/</url>
      
        <content type="html"><![CDATA[<p>&ensp;&ensp;&ensp;&ensp;本期教程将教会大家如何在你的vps部署Bark服务来监控资源和ssh登录信息。</p><h2 id="1-安装必要工具"><a href="#1-安装必要工具" class="headerlink" title="1. 安装必要工具"></a><strong>1. 安装必要工具</strong></h2> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt update</span><br><span class="line"><span class="built_in">sudo</span> apt install curl jq</span><br><span class="line"><span class="built_in">sudo</span> apt install nano</span><br></pre></td></tr></table></figure><h2 id="2-在vps上创建system-monitor-sh脚本"><a href="#2-在vps上创建system-monitor-sh脚本" class="headerlink" title="2.在vps上创建system-monitor.sh脚本"></a><strong>2.在vps上创建system-monitor.sh脚本</strong></h2><p>在ssh终端输入：<br> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> nano /usr/local/bin/system-monitor.sh</span><br></pre></td></tr></table></figure><br>进入nano编辑器后将一下内容粘贴进去<br> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 🛠️ 环境变量，防止系统找不到命令</span></span><br><span class="line"><span class="built_in">export</span> PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin</span><br><span class="line"></span><br><span class="line"><span class="comment"># 🔐 Bark 推送 Key 和图标 URL（请根据实际修改）</span></span><br><span class="line">BARK_KEY=<span class="string">&quot;abcdefg1234567&quot;</span>  <span class="comment"># 替换为你的 Bark API Key</span></span><br><span class="line">icon_url=<span class="string">&quot;https://th.bing.com/th/id/OIP.PnLgsfgLeK-s0mUrQOeonwAAAA?w=176&amp;h=180&amp;c=7&amp;r=0&amp;o=5&amp;dpr=1.8&amp;pid=1.7&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 🔍 获取主机名</span></span><br><span class="line">hostname=$(hostname)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 🌐 1️⃣ 资源监控部分</span></span><br><span class="line">MEMORY_THRESHOLD=60  <span class="comment"># 内存使用率阈值（%）</span></span><br><span class="line">CPU_THRESHOLD=65     <span class="comment"># CPU 使用率阈值（%）</span></span><br><span class="line"></span><br><span class="line">MEMORY_USAGE=$(free | awk <span class="string">&#x27;/Mem:/ &#123;printf(&quot;%.0f&quot;, $3/$2 * 100)&#125;&#x27;</span>)</span><br><span class="line">CPU_USAGE=$(top -bn1 | grep <span class="string">&quot;Cpu(s)&quot;</span> | awk <span class="string">&#x27;&#123;print 100 - $8&#125;&#x27;</span> | awk -F. <span class="string">&#x27;&#123;print $1&#125;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">log_message=<span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 🔍 检查内存使用率</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$MEMORY_USAGE</span>&quot;</span> -ge <span class="string">&quot;<span class="variable">$MEMORY_THRESHOLD</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    log_message+=<span class="string">&quot;内存占用率: <span class="variable">$MEMORY_USAGE</span>% (超过 <span class="variable">$&#123;MEMORY_THRESHOLD&#125;</span>%)。&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 🔍 检查 CPU 使用率</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$CPU_USAGE</span>&quot;</span> -ge <span class="string">&quot;<span class="variable">$CPU_THRESHOLD</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    log_message+=<span class="string">&quot;CPU 占用率: <span class="variable">$CPU_USAGE</span>% (超过 <span class="variable">$&#123;CPU_THRESHOLD&#125;</span>%)。&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ -n <span class="string">&quot;<span class="variable">$log_message</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    log_message=<span class="string">&quot;【<span class="variable">$hostname</span>】<span class="variable">$log_message</span>&quot;</span></span><br><span class="line">    encoded_message=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$log_message</span>&quot;</span> | jq -sRr @uri)</span><br><span class="line">    curl -s <span class="string">&quot;https://api.day.app/<span class="variable">$BARK_KEY</span>/<span class="variable">$encoded_message</span>?icon=<span class="variable">$icon_url</span>&amp;isCritical=1&quot;</span> &amp;&gt;/dev/null</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;资源监控推送已发送&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 🌐 2️⃣ SSH 登录提醒部分</span></span><br><span class="line"><span class="keyword">if</span> [ -n <span class="string">&quot;<span class="variable">$SSH_CONNECTION</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    ssh_ip=$(<span class="built_in">echo</span> <span class="variable">$SSH_CONNECTION</span> | awk <span class="string">&#x27;&#123;print $1&#125;&#x27;</span>)</span><br><span class="line">    user_name=$(<span class="built_in">whoami</span>)</span><br><span class="line">    ssh_message=<span class="string">&quot;【<span class="variable">$hostname</span>】SSH 登录警告: 用户 <span class="variable">$user_name</span> 从 IP <span class="variable">$ssh_ip</span> 登录&quot;</span></span><br><span class="line">    encoded_ssh_message=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$ssh_message</span>&quot;</span> | jq -sRr @uri)</span><br><span class="line">    curl -s <span class="string">&quot;https://api.day.app/<span class="variable">$BARK_KEY</span>/<span class="variable">$encoded_ssh_message</span>?icon=<span class="variable">$icon_url</span>&amp;isCritical=1&quot;</span> &amp;&gt;/dev/null</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;SSH 登录提醒已发送&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><br>完成后按下Ctrl+X键，输入Y，回车即可保存并退出nano</p><h2 id="3-为system-monitor-sh赋予权限"><a href="#3-为system-monitor-sh赋予权限" class="headerlink" title="3. 为system-monitor.sh赋予权限"></a><strong>3. 为system-monitor.sh赋予权限</strong></h2> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> <span class="built_in">chmod</span> +x /usr/local/bin/system-monitor.sh</span><br></pre></td></tr></table></figure><h2 id="4-开机命令"><a href="#4-开机命令" class="headerlink" title="4. 开机命令"></a><strong>4. 开机命令</strong></h2><p>分别在&#x2F;etc&#x2F;rc.local和&#x2F;etc&#x2F;profile中加上一下内容<br> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> nano /etc/rc.local</span><br></pre></td></tr></table></figure><br>把以下内容粘贴进去：</p><ul><li>&#x2F;usr&#x2F;local&#x2F;bin&#x2F;system-monitor.sh <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> nano /etc/profile</span><br></pre></td></tr></table></figure>把以下内容粘贴进去： <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/bin/system-monitor.sh</span><br></pre></td></tr></table></figure>Ctrl+X键，输入Y，回车即可保存并退出nano</li></ul><h2 id="5-设置定时任务（用来定时检测资源占用情况）"><a href="#5-设置定时任务（用来定时检测资源占用情况）" class="headerlink" title="5. 设置定时任务（用来定时检测资源占用情况）"></a><strong>5. 设置定时任务（用来定时检测资源占用情况）</strong></h2><p>每 5 分钟运行一次脚本：<br> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">crontab -e</span><br></pre></td></tr></table></figure><br>输入以下内容：<br> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">*/5 * * * * /usr/local/bin/system-monitor.sh</span><br></pre></td></tr></table></figure></p><ul><li>*&#x2F;5 * * * *代表每5分钟执行一次，如有其他需求请自行更改。</li></ul><p>检查日志，确认是否有定时任务运行，输入以下内容：<br> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep &#x27;system-monitor.sh&#x27; /var/log/syslog</span><br></pre></td></tr></table></figure></p><h2 id="5-验证脚本是否生效"><a href="#5-验证脚本是否生效" class="headerlink" title="5. 验证脚本是否生效"></a><strong>5. 验证脚本是否生效</strong></h2><p>输入以下内容：<br> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> nano /usr/local/bin/system-monitor.sh</span><br></pre></td></tr></table></figure><br>将MEMORY_THRESHOLD和CPU_THRESHOLD的值更改为1,以用来测试</p><ul><li>MEMORY_THRESHOLD&#x3D;1  # 内存阈值，单位为 %</li><li>CPU_THRESHOLD&#x3D;1     # CPU 阈值，单位为 %<br>依旧按下Ctrl+X键，输入Y，回车，保存并退出nano<br>运行命令： <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo /usr/local/bin/system-monitor.sh</span><br></pre></td></tr></table></figure>成功标志：</li><li>如果内存或 CPU 使用率超过了阈值（1% 和 1%），会收到一条 Bark 通知。</li><li>如果当前正处于 SSH 登录中，您也会收到 Bark 提醒。</li></ul><h2 id="6-调整相应的参数来满足自己的需求"><a href="#6-调整相应的参数来满足自己的需求" class="headerlink" title="6. 调整相应的参数来满足自己的需求"></a><strong>6. 调整相应的参数来满足自己的需求</strong></h2><p>输入以下内容：<br> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> nano /usr/local/bin/system-monitor.sh</span><br></pre></td></tr></table></figure><br>将MEMORY_THRESHOLD和CPU_THRESHOLD的值更改为自己想要的数值</p><ul><li>MEMORY_THRESHOLD&#x3D;60  # 内存阈值，单位为 % 更改为自己想要的数值</li><li>CPU_THRESHOLD&#x3D;60    # CPU 阈值，单位为 % 更改为自己想要的数值<br>按下Ctrl+X键，输入Y，回车，保存并退出nano</li></ul><p><strong>末尾</strong><br>&ensp;&ensp;&ensp;&ensp;至此就已经完成了在服务器上部署Bark推送服务来监控ssh登录以及相关资源利用。如有相关问题可联系<a href="https://t.me/LD2J_0618">作者本人TG联系</a>。<br>&ensp;&ensp;&ensp;&ensp;如您需引用此脚本请注明来源，在此万分感谢！</p>]]></content>
      
      
      
        <tags>
            
            <tag> Bark推送 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Loon：新手从入门到卸载的教程--名词篇</title>
      <link href="/essay/Loon%EF%BC%9A%E6%96%B0%E6%89%8B%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%8D%B8%E8%BD%BD/"/>
      <url>/essay/Loon%EF%BC%9A%E6%96%B0%E6%89%8B%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%8D%B8%E8%BD%BD/</url>
      
        <content type="html"><![CDATA[<p>&ensp;&ensp;&ensp;&ensp;依旧是开篇的一些废话（艹），因本教程面向的是刚刚购买APP或刚刚了解ios代理软件的新手小白，故本文将事无巨细（无比琐碎）为小白们传授相关知识。<br>&ensp;&ensp;&ensp;&ensp;<strong>侧栏会有跳转按钮，方便大家对应查找。</strong></p><h1 id="Loon有关的名词及其解释"><a href="#Loon有关的名词及其解释" class="headerlink" title="Loon有关的名词及其解释"></a><strong>Loon有关的名词及其解释</strong></h1><p>&ensp;&ensp;&ensp;&ensp;为什么会要先讲这个东西？因为是写给新手看的！</p><h2 id="1-Loon"><a href="#1-Loon" class="headerlink" title="1. Loon"></a><strong>1. Loon</strong></h2><ul><li>Loon是一款iOS上强大的网络工具，支持基于域名、IP、URL，SSID规则进行分流，强大的策略组组合可以满足任何的网络分流需求；Loon可以抓取、保存、修改HTTP&#x2F;HTTPs流量，配合Javascript可以处理任何复杂的需求。</li></ul><h2 id="2-节点"><a href="#2-节点" class="headerlink" title="2. 节点"></a><strong>2. 节点</strong></h2><ul><li>节点是指用于转发网络请求的服务器或中继点，可以通过购买服务器来搭建或购买机场服务来获得。<strong>注意：节点只负责转发流量</strong>由于众所周知（GFW）的原因，如果想要访问一些国外的网站，就需要一个中继点来转发你的请求以达到你访问外网的目的。<strong>注意Loon不会为你提供节点，你需要自行获取。</strong></li></ul><h2 id="3-机场"><a href="#3-机场" class="headerlink" title="3. 机场"></a><strong>3. 机场</strong></h2><ul><li>机场，一个为用户提供节点资源，帮助用户达到科学上网、加速访问目的的服务商。</li></ul><h2 id="4-订阅"><a href="#4-订阅" class="headerlink" title="4. 订阅"></a><strong>4. 订阅</strong></h2><ul><li>机场订阅内往往包含了多个节点，其中囊括了n个地区的多个节点，具体情况视机场服务说明。</li></ul><h2 id="5-规则"><a href="#5-规则" class="headerlink" title="5. 规则"></a><strong>5. 规则</strong></h2><ul><li>规则是决定使用哪个节点进行转发你的流量的必要条件。大家应该都见过小孩子玩的一种益智玩具–将不同形状的积木穿过不同形状的洞，大家可以把规则当做那个限制必须符合形状的积木才能通过的洞。Loon支持的规则类型如下（后续会详细介绍）： <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">域名类规则</span><br><span class="line">IP类规则</span><br><span class="line">HTTP类规则</span><br><span class="line">端口类规则</span><br><span class="line">协议类规则</span><br><span class="line">逻辑规则</span><br><span class="line">Final</span><br><span class="line">订阅规则</span><br></pre></td></tr></table></figure></li></ul><h2 id="6-域名类规则"><a href="#6-域名类规则" class="headerlink" title="6. 域名类规则"></a><strong>6. 域名类规则</strong></h2><h3 id="6-1-DOMAIN"><a href="#6-1-DOMAIN" class="headerlink" title="6.1 DOMAIN"></a>6.1 DOMAIN</h3><p>匹配整个域名<br> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DOMAIN,google.com,proxy</span><br></pre></td></tr></table></figure></p><h3 id="6-2-DOMAIN-SUFFIX"><a href="#6-2-DOMAIN-SUFFIX" class="headerlink" title="6.2 DOMAIN-SUFFIX"></a>6.2 DOMAIN-SUFFIX</h3><p>匹配域名后缀，例如apple.com可以匹配icloud.apple.com，<a href="http://www.apple.com,但是不能够匹配app-apple.com/">www.apple.com，但是不能够匹配app-apple.com</a><br> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DOMAIN-SUFFIX,apple.com,proxy</span><br></pre></td></tr></table></figure></p><h3 id="6-3-DOMAIN-KEYWORD"><a href="#6-3-DOMAIN-KEYWORD" class="headerlink" title="6.3 DOMAIN-KEYWORD"></a>6.3 DOMAIN-KEYWORD</h3><p>域名关键词匹配,例如下面，将匹配到所有包含apple的域名<br> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DOMAIN-KEYWORD,apple,proxy</span><br></pre></td></tr></table></figure></p><h2 id="7-IP类规则"><a href="#7-IP类规则" class="headerlink" title="7. IP类规则"></a><strong>7. IP类规则</strong></h2><h3 id="7-1-IPV4"><a href="#7-1-IPV4" class="headerlink" title="7.1 IPV4"></a>7.1 IPV4</h3><p>匹配IPV4类型的规则，IP后的&#x2F;32表示子网掩码，用于确定IP末位的范围,no-resolve表示无需DNS解析。<br> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">IP-CIDR,118.89.204.198/32,no-resolve</span><br></pre></td></tr></table></figure></p><h3 id="7-2-IPV6"><a href="#7-2-IPV6" class="headerlink" title="7.2 IPV6"></a>7.2 IPV6</h3><p>同理<br> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">IP-CIDR6,2402:4e00:1200:ed00:0:9089:6dac:96b6/128</span><br></pre></td></tr></table></figure></p><h3 id="7-3-GEOIP"><a href="#7-3-GEOIP" class="headerlink" title="7.3 GEOIP"></a>7.3 GEOIP</h3><p>根据mmdb查询的IP国家地区进行匹配。<strong>注意：请不要将关于cn的GEOIP规则放入本地规则中，详见规则匹配优先级</strong><br> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">geoip,cn,DIRECT</span><br></pre></td></tr></table></figure></p><h3 id="7-4-IP-ASN"><a href="#7-4-IP-ASN" class="headerlink" title="7.4 IP-ASN"></a>7.4 IP-ASN</h3><p>根据IP服务商进行匹配。<strong>注意：由于ASN数据库和ASN规则相较于GEOIP数据库和IP-CIDR规则精细度较差，若直接采用ASN规则，其效果不如GEOIP和IP-CIDR准确，所以不推荐优先使用。</strong><br> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">IP-ASN,4134,DIRECT,no-resolve</span><br></pre></td></tr></table></figure></p><h2 id="8-HTTP类规则"><a href="#8-HTTP类规则" class="headerlink" title="8. HTTP类规则"></a><strong>8. HTTP类规则</strong></h2><p>HTTP类型的规则只会对HTTP、HTTPS类型的请求进行匹配</p><h3 id="8-1-URL-REGEX"><a href="#8-1-URL-REGEX" class="headerlink" title="8.1 URL-REGEX"></a>8.1 URL-REGEX</h3><p>根据提供的正则表达式对请求的url进行匹配<br> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">URL-REGEX,^http://google\.com,PROXY</span><br></pre></td></tr></table></figure></p><h3 id="8-2-USER-AGENT"><a href="#8-2-USER-AGENT" class="headerlink" title="8.2 USER-AGENT"></a>8.2 USER-AGENT</h3><p>根据请求header中的user-agent进行匹配，支持通配符<br> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">USER-AGENT,Apple*,DIRECT</span><br></pre></td></tr></table></figure></p><h2 id="9-端口规则"><a href="#9-端口规则" class="headerlink" title="9. 端口规则"></a><strong>9. 端口规则</strong></h2><p>根据请求的源端口或者目标端口进行匹配（Loon 3.1.7+）。</p><ul><li>表示特定的某个端口，如DEST-PORT,443,DIRECT</li><li>表示端口闭区间，如DEST-PORT,80-443,DIRECT</li><li>使用&gt;, &lt;, &lt;&#x3D;, &gt;&#x3D; 表示一个无穷区间，如DEST-PORT,&gt;&#x3D;443,DIRECT</li></ul><h3 id="9-1-SRC-PORT"><a href="#9-1-SRC-PORT" class="headerlink" title="9.1 SRC-PORT"></a>9.1 SRC-PORT</h3> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SRC-PORT,443,DIRECT</span><br><span class="line">SRC-PORT,80-443,DIRECT</span><br><span class="line">SRC-PORT,&gt;=443,DIRECT</span><br></pre></td></tr></table></figure><h3 id="9-2-DEST-PORT"><a href="#9-2-DEST-PORT" class="headerlink" title="9.2 DEST-PORT"></a>9.2 DEST-PORT</h3> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">DEST-PORT,443,DIRECT</span><br><span class="line">DEST-PORT,80-443,DIRECT</span><br><span class="line">DEST-PORT,&gt;=443,DIRECT</span><br></pre></td></tr></table></figure><h2 id="10-协议类规则"><a href="#10-协议类规则" class="headerlink" title="10. 协议类规则"></a><strong>10. 协议类规则</strong></h2><p>根据请求的协议类型进行匹配（3.1.7+），目前支持HTTP&#x2F;HTTPS&#x2F;TCP&#x2F;QUIC&#x2F;STUN&#x2F;UDP。</p><h3 id="10-1-PROTOCOL"><a href="#10-1-PROTOCOL" class="headerlink" title="10.1 PROTOCOL"></a>10.1 PROTOCOL</h3> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PROTOCOL,STUN,REJECT</span><br></pre></td></tr></table></figure><h2 id="11-逻辑规则"><a href="#11-逻辑规则" class="headerlink" title="11. 逻辑规则"></a><strong>11. 逻辑规则</strong></h2><p>使用或(OR)、与(AND)、非(NOT)逻辑将多个规则合并成一个规则（3.1.7+）。</p><p>如果逻辑规则里面有域名有IP，尽量把IP的子规则放在后面，防止不必要的DNS查询。</p><h3 id="11-1-AND"><a href="#11-1-AND" class="headerlink" title="11.1 AND"></a>11.1 AND</h3><p>多个子规则同时满足时才会匹配。</p><p>写法：AND,((子规则),(子规则)),PolicyName  <strong>PolicyName为策略名，详见</strong><br> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AND,((DOMAIN-SUFFIX,axample),(DEST-PORT,443),(GEOIP,CN)),DIRECT</span><br></pre></td></tr></table></figure></p><h3 id="11-2-OR"><a href="#11-2-OR" class="headerlink" title="11.2 OR"></a>11.2 OR</h3><p>子规则满足一个时匹配。</p><p>写法：OR,((子规则),(子规则)),PolicyName  <strong>PolicyName为策略名，详见</strong><br> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">OR,((DOMAIN-SUFFIX,axample),(DEST-PORT,443),(GEOIP,CN,no-resolve)),DIRECT</span><br></pre></td></tr></table></figure></p><h3 id="11-3-NOT"><a href="#11-3-NOT" class="headerlink" title="11.3 NOT"></a>11.3 NOT</h3><p>子规则不满足时匹配，只有有一个子规则。</p><p>写法：NOT,((子规则)),PolicyName  <strong>PolicyName为策略名，详见</strong><br> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NOT,((AND,((DOMAIN-SUFFIX,axample),(DEST-PORT,443),(GEOIP,CN)))),DIRECT</span><br></pre></td></tr></table></figure></p><h2 id="12-Final"><a href="#12-Final" class="headerlink" title="12. Final"></a><strong>12. Final</strong></h2><p>Final表示最后、兜底，即在没有匹配到配置的规则后，使用Final指定的策略。<br> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">final,DIRECT</span><br></pre></td></tr></table></figure></p><h2 id="13-订阅规则"><a href="#13-订阅规则" class="headerlink" title="13. 订阅规则"></a><strong>13. 订阅规则</strong></h2><p>订阅规则是一系列规则的集合，只要是满足Loon类型的规则都可以放入规则集中。<br><strong>注意：这只是示例，切勿添加</strong><br> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://raw.githubusercontent.com/Loon0x00/LoonExampleConfig/master/Rule/ExampleRule.list, PROXY</span><br></pre></td></tr></table></figure></p><h2 id="14-规则匹配优先级"><a href="#14-规则匹配优先级" class="headerlink" title="14. 规则匹配优先级"></a><strong>14. 规则匹配优先级</strong></h2><p>域名和IP类型的规则有优先级，其他所有规则会按照配置文件中的顺序来决定优先级，即：排在前面的优先级高于排在后面的；同时本地规则 &gt; 插件中的规则 &gt; 订阅规则，未匹配到任何规则后会使用Final。</p><h2 id="15-策略"><a href="#15-策略" class="headerlink" title="15. 策略"></a><strong>15. 策略</strong></h2><p>在Loon中策略可以是 a)内置策略 b）单独的一个节点 c) 一个由多个节点组成的策略（组）<br>Loon的流量走向机制：</p><blockquote><p>拿到手机的请求 -&gt; 匹配规则 -&gt; 查询规则指定的策略 -&gt; 根据策略获取到相应的节点<br>即<strong>节点负责转发流量</strong>，<strong>规则可以指向策略</strong>，<strong>策略决定使用的节点&#x2F;内置策略</strong></p></blockquote><h3 id="15-1-DIRECT-直连"><a href="#15-1-DIRECT-直连" class="headerlink" title="15.1 DIRECT(直连)"></a>15.1 DIRECT(直连)</h3><p>流量不经过任何代理服务器，直接发送到目的地，使用大写的DIRECT表示。<br> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DOMAIN,apple.com,DIRECT</span><br></pre></td></tr></table></figure></p><h3 id="15-2-REJECT-拒绝"><a href="#15-2-REJECT-拒绝" class="headerlink" title="15.2 REJECT(拒绝)"></a>15.2 REJECT(拒绝)</h3><p>顾名思义就是不将流量转发出去到任何服务器，可以理解为将家里的门锁上，你就出不去了。<br>Loon提供以下REJECT(拒绝)策略<br> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">REJECT (返回404和空响应体)</span><br><span class="line">REJECT-IMG (返回200和一个 1px GIF 的响应体)</span><br><span class="line">REJECT-DICT (返回200和内容为空的 JSON 的响应体)</span><br><span class="line">EJECT-ARRY (返回200和一个内容为空的 JSON 数组)</span><br><span class="line">REJECT-DROP (拒绝并丢弃请求，且不会返回任何响应。因为部分程序有着十分暴力的重试逻辑，连接失败后会立刻进行重试，导致请求风暴)</span><br></pre></td></tr></table></figure></p><h2 id="16-策略组"><a href="#16-策略组" class="headerlink" title="16. 策略组"></a><strong>16. 策略组</strong></h2><p>策略组是一系列策略、策略组的集合，手动或自动的决定使用策略组中的哪一个策略，可以在配置文件中**[Proxy Group]**模块下添加或更改，策略组是可以相互嵌套的。<br>Loon提供的策略组类型如下：<br> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">select 策略组</span><br><span class="line">url-test 策略组</span><br><span class="line">fallback</span><br><span class="line">load-balance</span><br></pre></td></tr></table></figure></p><h3 id="16-1-select-策略组"><a href="#16-1-select-策略组" class="headerlink" title="16.1 select 策略组"></a>16.1 select 策略组</h3><p>该类型的测录组是手动类型，需要你在策略页面进行手动选择要使用的策略。</p><h3 id="16-2-url-test-策略组"><a href="#16-2-url-test-策略组" class="headerlink" title="16.2 url-test 策略组"></a>16.2 url-test 策略组</h3><p>根据提供的url，每隔一段时间对该策略组下的所有节点进行测速，选择最快的一个节点使用。<br>可在UI&#x2F;配置文件中配置一下参数：<br> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">url：测速的url，loon会向该url发起header请求</span><br><span class="line">interval：测速间隔时间，单位秒</span><br><span class="line">tolerance：容差，如果当前测速后的最优节点和之前最优节点的测速相差小于tolerance，将不会进行节点切换，单位毫秒</span><br></pre></td></tr></table></figure></p><h3 id="16-3-fallback"><a href="#16-3-fallback" class="headerlink" title="16.3 fallback"></a>16.3 fallback</h3><p>根据提供的url，每隔一段时间对该策略组下的所有节点进行测速，选择第一个可用的节点使用。即哪个节点相应最快就使用哪个节点（相应最快不代表该节点最优）。<br>可在UI&#x2F;配置文件中配置一下参数：<br> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">url：测速的url，loon会向该url发起header请求</span><br><span class="line">interval：测速间隔时间，单位秒</span><br><span class="line">max-timeout：最大超时时间，如果一个节点测速超过了这个值，就将该节点认作为不可用节点，不会进行排序，单位毫秒</span><br></pre></td></tr></table></figure></p><h3 id="16-4-load-balance"><a href="#16-4-load-balance" class="headerlink" title="16.4 load-balance"></a>16.4 load-balance</h3><p>负载均衡，根据所选的负载均衡算法，自动选择子策略。<br>可在UI&#x2F;配置文件中配置一下参数：<br> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">url：测速的url，loon会向该url发起header请求</span><br><span class="line">interval：测速间隔时间，单位秒</span><br><span class="line">max-timeout：最大超时时间，如果一个节点测速超过了这个值，就将该节点认作为不可用节点，不会进行排序，单位毫秒</span><br></pre></td></tr></table></figure><br>可选负载均衡算法(algorithm)：<br> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Random：随机选择子策略</span><br><span class="line">PCC：基于Random，不同于Random，PCC会让相同主机名的请求锁定同一节点</span><br><span class="line">Round-Robin：轮询选择子策略</span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      
        <tags>
            
            <tag> Loon教程 专业名词 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>教程开始前的一些有用的话</title>
      <link href="/essay/%E6%95%99%E7%A8%8B%E5%BC%80%E5%A7%8B%E5%89%8D%E7%9A%84%E4%B8%80%E4%BA%9B%E6%9C%89%E7%94%A8%E7%9A%84%E8%AF%9D/"/>
      <url>/essay/%E6%95%99%E7%A8%8B%E5%BC%80%E5%A7%8B%E5%89%8D%E7%9A%84%E4%B8%80%E4%BA%9B%E6%9C%89%E7%94%A8%E7%9A%84%E8%AF%9D/</url>
      
        <content type="html"><![CDATA[<h1 id="教程开始前的一些有用的话"><a href="#教程开始前的一些有用的话" class="headerlink" title="教程开始前的一些有用的话"></a>教程开始前的一些有用的话</h1><p>&ensp;&ensp;&ensp;&ensp;笔者本人并非相关专业出身，许多关于代理工具的知识都是通过<strong>谷歌</strong>、<strong>GPT</strong>、<strong>向大佬们寻求帮助</strong>获得的，正因如此笔者就希望和大家分享如何更加有效地获取知识、解决问题。当然笔者可能会在通篇文章里犯很多错误，还望得到大家指正。<br>&ensp;&ensp;&ensp;&ensp;为什么会有这个教程？因为笔者已经无数次回答了一些过于简单的问题，群里的一些大佬也会被这些简单的问题给搞的心烦意乱，这样就会导致真正需要得到帮助的朋友更难获得帮助。所以在教程开始前希望大家能够静下心来，让笔者教会你如何更加有效地获得帮助。</p><h2 id="1-提问的智慧"><a href="#1-提问的智慧" class="headerlink" title="1. 提问的智慧"></a>1. 提问的智慧</h2><ul><li><strong>礼貌是尊重他人，尊重自己的首要社交表现</strong></li><li><strong>三人行，必有我师焉</strong></li><li><strong>清晰地知道自己的问题是什么</strong></li><li><strong>没有人有义务帮助你</strong></li><li><strong>抛开以自我为中心的世界观</strong></li></ul><h2 id="2-提问的艺术"><a href="#2-提问的艺术" class="headerlink" title="2. 提问的艺术"></a>2. 提问的艺术</h2><ul><li><strong>求人不如求己、自己动手丰衣足食</strong></li><li><strong>能够分清好问题与坏问题</strong></li><li><strong>清晰、简明扼要地叙述你所遇到的问题是为了别人能迅速了解你的问题并帮助你解决的前提</strong></li><li><strong>“请问”、“大佬们”、“感谢”这些礼貌的用语会让你更容易地得到帮助，礼多人不怪</strong></li><li><strong>描述问题的症状而非你的结论，切勿由果推因、妄下结论</strong></li><li><strong>问题解决后，要及时地反馈，以便后来者能受惠于你，你也会得到先行者的帮助</strong></li><li><strong>如果你遵守了以上几点，却得不到回答，可能是目前没有人能够解答这个问题，请耐心等待</strong></li></ul><p>&ensp;&ensp;&ensp;&ensp;笔者认为教程开始前的唠叨，应当简单一些，但不能稀里糊涂地让大家就进入教程阶段，后续四处碰壁。</p><p>&ensp;&ensp;&ensp;&ensp;如果大家想要给详细深入的了解“如何提问”，请参照<a href="https://web.archive.org/web/20240516162610/https://github.com/ryanhanwu/How-To-Ask-Questions-The-Smart-Way/blob/main/README-zh_CN.md">提问的艺术</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> Loon教程 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
